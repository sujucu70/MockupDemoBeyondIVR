<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo Interactiva: Atención al Cliente Inteligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .phone-screen {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05), 0 0 0 1px rgba(255, 255, 255, 0.1);
        }
        .transcript-bubble {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        .transcript-bubble.visible {
            opacity: 1;
            transform: translateY(0);
        }
        /* Estilos para el log técnico */
        .tech-log-container {
            font-family: 'Roboto Mono', monospace;
            background-color: #000;
            border: 1px solid #374151;
            height: 100%;
        }
        .log-entry {
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .log-entry.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .log-entry .source { color: #60A5FA; /* blue-400 */ }
        .log-entry .target { color: #F87171; /* red-400 */ }
        .log-entry .action { color: #4ADE80; /* green-400 */ }
        .log-entry .data { color: #9CA3AF; /* gray-400 */ }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-7xl mx-auto bg-gray-800 rounded-2xl p-6 md:p-8 shadow-2xl border border-gray-700">
        <div class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-white">Demo Interactiva</h1>
            <p class="text-lg text-gray-400 mt-2">Atención al Cliente Inteligente por Voz</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Columna Izquierda: Log Técnico -->
            <div class="bg-gray-900 p-6 rounded-xl border border-gray-700 flex flex-col">
                <h2 class="text-xl font-semibold mb-4 text-center">Log de Eventos del Sistema</h2>
                <div id="tech-log" class="tech-log-container p-4 rounded-lg overflow-y-auto flex-grow">
                    <!-- El log se añadirá aquí -->
                </div>
            </div>

            <!-- Columna Derecha: Simulación de la Llamada -->
            <div class="bg-gray-900 p-6 rounded-xl border border-gray-700 flex flex-col">
                <h2 class="text-xl font-semibold mb-4 text-center">Simulación de la Llamada</h2>
                <div class="bg-black rounded-3xl p-4 border-4 border-gray-700 phone-screen max-w-sm mx-auto">
                    <div class="flex justify-between items-center text-sm text-gray-400 px-2">
                        <span id="currentTime">10:30</span>
                        <div class="bg-gray-800 h-6 w-24 rounded-full"></div>
                        <span>85%</span>
                    </div>
                    <div class="text-center mt-8">
                        <div class="w-20 h-20 bg-blue-500 rounded-full mx-auto flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white" viewBox="0 0 20 20" fill="currentColor"><path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.518.759a11.03 11.03 0 004.28 4.28l.759-1.518a1 1 0 011.06-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z" /></svg>
                        </div>
                        <p id="callerName" class="text-2xl font-semibold mt-4">Soporte Telco</p>
                        <p id="callStatus" class="text-gray-400 mt-1">llamada entrante...</p>
                        <p id="callTimer" class="text-gray-400 mt-4 text-lg">00:00</p>
                    </div>
                    <div class="mt-8 h-20"></div>
                </div>
                <div id="transcript-container" class="mt-6 space-y-4 flex-grow overflow-y-auto pr-2">
                    <!-- Las burbujas de la conversación se añadirán aquí -->
                </div>
            </div>
        </div>

        <div class="mt-8 text-center">
            <button id="demo-control-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full text-lg transition-all duration-300 shadow-lg">
                ▶ Iniciar Demo
            </button>
        </div>
    </div>

<script>
    const demoSteps = [
        {
            speaker: "Bot", text: "Hola Carlos, bienvenido al soporte. Veo que tu última factura se emitió hace un par de días. ¿Es posible que llames por alguna consulta sobre ella?",
            logs: [
                { text: "[PBX] -> [ASISTENTE_BEYOND] - INCOMING_CALL: +34..." },
                { text: "[ASISTENTE_BEYOND] -> [API_CRM] - POST /lookup_customer" },
                { text: "[API_CRM] -> [ASISTENTE_BEYOND] - RESPONSE: {name: 'Carlos'}" },
                { text: "[ASISTENTE_BEYOND] -> [API_BILLING] - GET /last_invoice" },
                { text: "[API_BILLING] -> [ASISTENTE_BEYOND] - RESPONSE: {status: 'issued'}" },
                { text: "[ASISTENTE_BEYOND] -> [TTS_ENGINE] - GENERATE_SPEECH" }
            ],
            callerName: "Carlos", callStatus: "Llamada en curso"
        },
        {
            speaker: "Carlos", text: "Sí, exacto. Es que me ha llegado una factura de 85 euros y no entiendo por qué ha subido tanto este mes.",
            logs: [
                { text: "[STT_ENGINE] -> [ASISTENTE_BEYOND] - TRANSCRIPTION_RESULT" },
                { text: "[ASISTENTE_BEYOND] -> [NLU_ENGINE] - PROCESS_INTENT: 'query_invoice_issue'" }
            ]
        },
        {
            speaker: "Bot", text: "Entiendo tu preocupación, déjame que lo revise... Vale, ya lo tengo. Veo que el incremento se debe a la suscripción al paquete 'Cine Total'. ¿Puede ser?",
            logs: [
                { text: "[ASISTENTE_BEYOND] -> [API_BILLING] - GET /invoice_details/inv_123" },
                { text: "[API_BILLING] -> [ASISTENTE_BEYOND] - RESPONSE: {charge: 'Cine Total'}" },
                { text: "[ASISTENTE_BEYOND] -> [TTS_ENGINE] - GENERATE_SPEECH" }
            ]
        },
        {
            speaker: "Carlos", text: "Ah, es verdad, lo activé para una prueba. Pues no me interesa mantenerlo.",
            logs: [
                { text: "[STT_ENGINE] -> [ASISTENTE_BEYOND] - TRANSCRIPTION_RESULT" },
                { text: "[ASISTENTE_BEYOND] -> [NLU_ENGINE] - PROCESS_INTENT: 'cancel_subscription'" }
            ]
        },
        {
            speaker: "Bot", text: "No hay problema. Si lo deseas, puedo cancelar la suscripción ahora mismo para que no se genere ningún cargo en tu próxima factura. ¿Quieres que lo haga?",
            logs: [
                { text: "[ASISTENTE_BEYOND] -> [TTS_ENGINE] - GENERATE_SPEECH" }
            ]
        },
        {
            speaker: "Carlos", text: "Pues mira, antes de cancelarlo, preferiría hablar con una persona para ver si hay alguna oferta o promoción.",
            logs: [
                { text: "[STT_ENGINE] -> [ASISTENTE_BEYOND] - TRANSCRIPTION_RESULT" },
                { text: "[ASISTENTE_BEYOND] -> [NLU_ENGINE] - PROCESS_INTENT: 'request_human_agent'" }
            ]
        },
        {
            speaker: "Bot", text: "Por supuesto. Te paso ahora mismo con un agente. Y no te preocupes, le voy a transmitir toda nuestra conversación. Por favor, espera un momento.",
            logs: [
                { text: "[ASISTENTE_BEYOND] -> [CONTEXT_MANAGER] - PACKAGE_SESSION_DATA" },
                { text: "[ASISTENTE_BEYOND] -> [PBX] - INITIATE_TRANSFER: to queue 'sales_promo'" }
            ],
            callStatus: "Transfiriendo..."
        },
        {
            speaker: "Agente", text: "¡Hola Carlos, soy Marta! Gracias por esperar. Mi compañero virtual me pasó tu caso. Veo que quieres ver si hay alguna promoción para el paquete 'Cine Total', ¿correcto?",
            logs: [
                { text: "[PBX] -> [AGENT_SOFTPHONE] - CALL_ACCEPTED" },
                { text: "[CONTEXT_MANAGER] -> [AGENT_SOFTPHONE] - DISPLAY_CONTEXT_DATA" }
            ],
            callerName: "Marta (Agente)"
        }
    ];

    const controlBtn = document.getElementById('demo-control-btn');
    const transcriptContainer = document.getElementById('transcript-container');
    const techLogContainer = document.getElementById('tech-log');
    const callerNameEl = document.getElementById('callerName');
    const callStatusEl = document.getElementById('callStatus');
    const callTimerEl = document.getElementById('callTimer');
    const currentTimeEl = document.getElementById('currentTime');

    let currentStep = -1;
    let timerInterval;

    function updateClock() {
        const now = new Date();
        currentTimeEl.textContent = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
    }
    setInterval(updateClock, 1000);
    updateClock();

    function startTimer() {
        let seconds = 0;
        timerInterval = setInterval(() => {
            seconds++;
            const mins = String(Math.floor(seconds / 60)).padStart(2, '0');
            const secs = String(seconds % 60).padStart(2, '0');
            callTimerEl.textContent = `${mins}:${secs}`;
        }, 1000);
    }

    function stopTimer() { clearInterval(timerInterval); }

    function createBubble(speaker, text) {
        const bubble = document.createElement('div');
        bubble.className = 'p-3 rounded-lg max-w-xs md:max-w-md transcript-bubble';
        if (speaker === 'Carlos') {
            bubble.classList.add('bg-blue-600', 'rounded-br-none', 'ml-auto');
            bubble.innerHTML = `<p class="text-white">${text}</p>`;
        } else {
            bubble.classList.add('bg-gray-700', 'rounded-bl-none', 'mr-auto');
            bubble.innerHTML = `<p class="font-semibold text-blue-300 mb-1">${speaker}</p><p class="text-gray-200">${text}</p>`;
        }
        transcriptContainer.appendChild(bubble);
        transcriptContainer.scrollTop = transcriptContainer.scrollHeight;
        setTimeout(() => bubble.classList.add('visible'), 50);
    }

    function addLogEntry(logText) {
        const entry = document.createElement('div');
        entry.className = 'log-entry text-sm';
        
        const timestamp = new Date().toLocaleTimeString('es-ES', { hour12: false });
        
        // Simple parser for color coding
        const coloredText = logText.replace(/\[([^\]]+)\]/g, (match, p1) => {
            let colorClass = 'source';
            if (match.includes('->')) {
                 const parts = p1.split(' -> ');
                 return `<span class="source">[${parts[0]}]</span> -&gt; <span class="target">[${parts[1]}]</span>`;
            }
            return `<span class="action">[${p1}]</span>`;
        });

        entry.innerHTML = `<span class="text-gray-500">${timestamp}</span> - ${coloredText}`;
        techLogContainer.appendChild(entry);
        techLogContainer.scrollTop = techLogContainer.scrollHeight;
        setTimeout(() => entry.classList.add('visible'), 50);
    }


    function renderStep(stepIndex) {
        const step = demoSteps[stepIndex];
        if (!step) return;

        createBubble(step.speaker, step.text);
        
        let logDelay = 100;
        step.logs.forEach(log => {
            setTimeout(() => addLogEntry(log.text), logDelay);
            logDelay += 150; // Stagger the log appearance
        });

        if (step.callerName) callerNameEl.textContent = step.callerName;
        if (step.callStatus) callStatusEl.textContent = step.callStatus;
    }

    function resetDemo() {
        currentStep = -1;
        transcriptContainer.innerHTML = '';
        techLogContainer.innerHTML = '<span class="text-gray-600">Esperando inicio de la demo...</span>';
        callerNameEl.textContent = 'Soporte Telco';
        callStatusEl.textContent = 'llamada entrante...';
        callTimerEl.textContent = '00:00';
        controlBtn.textContent = '▶ Iniciar Demo';
        controlBtn.className = 'bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-full text-lg transition-all duration-300 shadow-lg';
        stopTimer();
    }

    controlBtn.addEventListener('click', () => {
        if (currentStep === -1) {
            techLogContainer.innerHTML = ''; // Clear initial message
            currentStep++;
            controlBtn.textContent = 'Siguiente Paso →';
            startTimer();
            renderStep(currentStep);
        } else if (currentStep < demoSteps.length - 1) {
            currentStep++;
            renderStep(currentStep);
            if (currentStep === demoSteps.length - 1) {
                controlBtn.textContent = 'Reiniciar Demo';
                controlBtn.className = 'bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full text-lg transition-all duration-300 shadow-lg';
            }
        } else {
            resetDemo();
        }
    });

    // Initial state
    resetDemo();
</script>

</body>
</html>
